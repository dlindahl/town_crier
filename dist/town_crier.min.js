/*! Town Crier - v0.0.1 - 2014-01-20
* https://github.com/dlindahl/town_crier
* Copyright (c) 2014 Derek Lindahl; Licensed MIT, GPL */
!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error("Cannot find module '"+g+"'")}var j=c[g]={exports:{}};b[g][0].call(j.exports,function(a){var c=b[g][1][a];return e(c?c:a)},j,j.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b){function c(a){return a?(Object.keys(a).forEach(function(b){v[b]=a[b]}),v):v}function d(a){Object.keys(v).forEach(function(b){"undefined"==typeof a[b]&&(a[b]=v[b])}),this.options=a,this.state=s}function f(){this.trigger("reconnect",e,this),this.connect()}function g(a){this.state=u,this.trigger("open",a,this)}function h(){this.trigger("message",this)}function i(a){var b=a.currentTarget;b.readyState===m.CLOSED?this.state==t?setTimeout(f.bind(this),this.options.retryInterval):this.disconnect():b.readyState===m.CONNECTING?(this.state=t,this.trigger("reconnect",a,this)):this.trigger("error",a,this)}function j(){this.trigger("close",this)}function k(){var a=this.options.hostname,b=a+"/firehose/"+this.options.appName;return this.options.token&&(b+="?token="+this.options.token),this.options.bindings.forEach(function(a){if(""===a.exchange)throw new Error('Invalid Exchange name: "'+a.exchange+'"');b+="&exchanges[]="+a.exchange,b+="&routingKeys[]="+a.routingKey}),b+="&userId="+this.options.userId,this._onOpen=g.bind(this),this._onMessage=h.bind(this),this._onError=i.bind(this),this._onClose=j.bind(this),this.state=t,this.source=new m(b),this.source.addEventListener("open",this._onOpen,!1),this.source.addEventListener("message",this._onOpen,!1),this.source.addEventListener("error",this._onError,!1),this.source.addEventListener("close",this._onClose,!1),this}function l(){return this.source.close(),this._onOpen&&(this.source.removeEventListener("open",this._onOpen),delete this._onOpen),this._onMessage&&(this.source.removeEventListener("message",this._onMessage),delete this._onMessage),this._onError&&(this.source.removeEventListener("error",this._onError),delete this._onError),this._onClose&&(this.source.removeEventListener("close",this._onClose),delete this._onClose),delete this.source,this.state=s,this.trigger("close",this),this}var m=window.EventSource,n=a("./version"),o=a("./events"),p=o.bind,q=o.unbind,r=o.trigger,s=0,t=1,u=2,v={appName:null,hostname:"",token:"",userId:"",retryInterval:3e3};d.__defineGetter__("config",function(){return Object.create(v)});var w=d;w.configure=c,w.VERSION=n,w.prototype={connect:k,disconnect:l,trigger:r,bind:p,unbind:q,on:p,off:q},b.exports=w},{"./events":2,"./version":4}],2:[function(a,b){function c(a,b){var c=a.split(" "),d=this._callbacks||(this._callbacks={});return c.forEach(function(a){d[a]||(d[a]=[]),d[a].push(b)}),this}function d(a,b){if(0===arguments.length)return this._callbacks={},this;if(!a)return this;var c,d=a.split(" ");return d.forEach(function(a){return(c=this._callbacks[a])?b?void c.forEach(function(a,d){return a?a!==b?!0:(c=c.slice(),c.splice(d,1),this._callbacks=c,!1):!0}.bind(this)):(delete this._callbacks[a],this):this}.bind(this)),this}function e(){var a=0===arguments.length?[]:Array.prototype.slice.call(arguments,0),b=a.shift(),c=this._callbacks[b];if(c)return c.forEach(function(b){return b.apply(this,a)===!1?!1:void 0}),!0}b.exports={bind:c,unbind:d,trigger:e}},{}],3:[function(a){window.TownCrier=a("./client")},{"./client":1}],4:[function(a,b){b.exports="0.0.1"},{}]},{},[3]);