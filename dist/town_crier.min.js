/*! Town Crier - v0.0.1 - 2014-01-20
* https://github.com/dlindahl/town_crier
* Copyright (c) 2014 Derek Lindahl; Licensed MIT, GPL */
!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error("Cannot find module '"+g+"'")}var j=c[g]={exports:{}};b[g][0].call(j.exports,function(a){var c=b[g][1][a];return e(c?c:a)},j,j.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b){function c(a){return a?(Object.keys(a).forEach(function(b){w[b]=a[b]}),w):w}function d(a){a||(a={}),Object.keys(w).forEach(function(b){"undefined"==typeof a[b]&&(a[b]=w[b])}),this.options=a,this.state=t}function e(a){this.trigger("reconnect",a,this),this.connect()}function f(a){this.state=v,this.trigger("open",a,this)}function g(a){var b=a.data;try{b=JSON.parse(b)}catch(c){}this.trigger("message",b,a,this)}function h(a){var b=a.currentTarget;b.readyState===m.CLOSED?this.state==u?setTimeout(e.bind(this,a),this.options.retryInterval):this.disconnect():b.readyState===m.CONNECTING?(this.state=u,this.trigger("reconnect",a,this)):this.trigger("error",a,this)}function i(a){this.trigger("close",a,this)}function j(a){var b=[];if((!a.url||a.url&&!/\S/.test(a.url))&&b.push("URL cannot be blank"),!a.bindings||a.bindings&&!a.bindings.length||0===a.bindings.length?b.push("Bindings cannot be empty"):a.bindings.forEach(function(a){return a.exchange&&""!==a.exchange?a.routingKey&&""!==a.routingKey?void 0:(b.push("Binding routing key cannot be blank"),!1):(b.push("Binding exchange cannot be blank"),!1)}),b.length>0)throw new o.InvalidConfiguration(b.join(", "))}function k(){j(this.options);var a=this.options.url;return this.options.token&&(a+="?token="+this.options.token),this.options.userId&&(a+="&userId="+this.options.userId),this.options.bindings.forEach(function(b){a+="&exchanges[]="+b.exchange,a+="&routingKeys[]="+b.routingKey}),this._onOpen=f.bind(this),this._onMessage=g.bind(this),this._onError=h.bind(this),this._onClose=i.bind(this),this.state=u,this.source=new m(a),this.source.addEventListener("open",this._onOpen,!1),this.source.addEventListener("message",this._onMessage,!1),this.source.addEventListener("error",this._onError,!1),this.source.addEventListener("close",this._onClose,!1),this}function l(){return this.source.close(),this._onOpen&&(this.source.removeEventListener("open",this._onOpen),delete this._onOpen),this._onMessage&&(this.source.removeEventListener("message",this._onMessage),delete this._onMessage),this._onError&&(this.source.removeEventListener("error",this._onError),delete this._onError),this._onClose&&(this.source.removeEventListener("close",this._onClose),delete this._onClose),delete this.source,this.state=t,this.trigger("close",this),this}var m=window.EventSource,n=a("./version"),o=a("./errors"),p=a("./events"),q=p.bind,r=p.unbind,s=p.trigger,t=m.CLOSED,u=m.CONNECTING,v=m.OPEN,w={url:null,token:null,userId:null,retryInterval:3e3};d.__defineGetter__("config",function(){return Object.create(w)});var x=d;x.configure=c,x.VERSION=n,x.prototype={connect:k,disconnect:l,trigger:s,bind:q,unbind:r,on:q,off:r},b.exports=x},{"./errors":2,"./events":3,"./version":5}],2:[function(a,b,c){function d(a){Error.call(this),Error.captureStackTrace(this,arguments.callee),this.message=a}d.prototype=Error.prototype,d.prototype.name="TownCrierError",c.TownCrierError=d;var e=[["InvalidConfiguration","Invalid configuration"]];e.forEach(function(a){var b=a[0],e=a[1];errorFn=c[b]=function(a){d.call(this,a||e)},errorFn.prototype=d.prototype,errorFn.prototype.name="TownCrierError::"+b})},{}],3:[function(a,b){function c(a,b){var c=a.split(" "),d=this._callbacks||(this._callbacks={});return c.forEach(function(a){d[a]||(d[a]=[]),d[a].push(b)}),this}function d(a,b){if(0===arguments.length)return this._callbacks={},this;if(!a)return this;var c,d=a.split(" ");return d.forEach(function(a){return(c=this._callbacks[a])?b?void c.forEach(function(a,d){return a?a!==b?!0:(c=c.slice(),c.splice(d,1),this._callbacks=c,!1):!0}.bind(this)):(delete this._callbacks[a],this):this}.bind(this)),this}function e(){var a=0===arguments.length?[]:Array.prototype.slice.call(arguments,0),b=a.shift(),c=this._callbacks[b];if(c)return c.forEach(function(b){return b.apply(this,a)===!1?!1:void 0}),!0}b.exports={bind:c,unbind:d,trigger:e}},{}],4:[function(a){window.TownCrier=a("./client")},{"./client":1}],5:[function(a,b){b.exports="0.0.1"},{}]},{},[4]);